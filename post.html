<!DOCTYPE html>
<html lang="en">

<head>
  <script>
    (function () {
      var stored = localStorage.getItem('theme');
      var prefers = window.matchMedia('(prefers-color-scheme:dark)').matches;
      if (stored === 'dark' || (!stored && prefers)) {
        document.documentElement.classList.add('dark-mode');
      }
    })();
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Post - Robin's Site</title>

  <link rel="stylesheet" href="css/shared.css" />
  <link rel="stylesheet" href="css/post.css" />
  <link id="hljs-light" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/github.min.css">
  <link id="hljs-dark" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/github-dark.min.css" disabled>

  <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/lib/highlight.min.js"></script>

  <script>
    function applyHljsTheme(mode) {
      const light = document.getElementById('hljs-light');
      const dark = document.getElementById('hljs-dark');
      if (mode === 'dark') {
        dark.removeAttribute('disabled');
        light.setAttribute('disabled', '');
      } else {
        light.removeAttribute('disabled');
        dark.setAttribute('disabled', '');
      }
    }
    window.onThemeChange = applyHljsTheme;
    document.addEventListener('DOMContentLoaded', () => {
      applyHljsTheme(document.documentElement.classList.contains('dark-mode') ? 'dark' : 'light');
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self';
         script-src 'self' https://cdn.jsdelivr.net;
         connect-src 'self';
         style-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net;
         font-src 'self' https://cdn.jsdelivr.net;
         img-src 'self' data:;">
</head>

<body>
  <header id="header-placeholder"></header>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.2/dist/purify.min.js"></script>
  <article id="post-content"></article>

  <section id="comments-section">
    <h2>Comments</h2>
    <div id="comments-list"></div>

    <h3>Add a Comment</h3>
    <form id="comment-form">
      <label for="comment-author">Your Name</label>
      <input type="text" id="comment-author" placeholder="Your name (default: Anonymous)" />

      <label for="comment-text">Your Comment</label>
      <textarea id="comment-text" required placeholder="Write your comment..."></textarea>

      <button type="submit">Post Comment</button>
    </form>
  </section>

  <a href="blog.html" class="back-link">Back to Blog</a>

  <footer id="footer-placeholder"></footer>

  <script src="js/mathjax.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" async></script>
  <script type="module" src="js/header-footer.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
  <script src="posts/js/post.js"></script>
  <script src="posts/js/comments.js"></script>
</body>

</html>